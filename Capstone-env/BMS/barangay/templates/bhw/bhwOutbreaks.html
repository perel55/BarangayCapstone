{% load static %}
{% block css %}
<link rel="stylesheet" href="{% static 'css/bhwOutbreak.css' %}">
<script type="module" src="{% static 'js/outbreak.js' %}"></script>
{% endblock %}


{% block content %}  
        {% include 'bhw/bhwTopnav.html' %} 
    <div class="adminContainer">

        <div class="MC-Top">
            <div class="TopContainer">
                <div class="Right">
                    <button id="Outbreak-btn">Outbreak</button>
                    <button id="totalCases-btn">Total Cases</button>
                </div>
        
                <div class="Left">
                    <button id="openModalButton">Add Outbreak</button>
                </div>
            </div>
        </div>
        

        
        <div class="MC-Bottom"> 
            {% include './bhwNav.html' %} 
            <div class="contents">
                <section id="content">
                    <div class="Outbreak" id="Outbreak-area">
                        <table>
                            <thead>
                                <tr>
                                    <th>Outbreak Name</th>
                                    <th>Resident Name</th>
                                    <th>Purok</th>
                                    <th>Severity</th>
                                    <th>Date</th>
                                    <th>Update</th>
                                </tr>
                            </thead>

                            <tbody>
                                {% for outbreak in outbreaks %}
                                <tr>
                                    <td>{{ outbreak.outbreak_name }}</td>
                                    <td>{{ outbreak.fname }} {{ outbreak.lname }}</td>
                                    <td>{{ outbreak.purok }}</td>
                                    <td>{{ outbreak.severity }}</td>
                                    <td>{{ outbreak.date }}</td>
                                    <td>
                                        <button class="update-btn" data-date="{{ outbreak.date }}"data-id="{{ outbreak.id }}" data-outbreak_name="{{ outbreak.outbreak_name }}" data-fname="{{ outbreak.fname }}"data-lname="{{ outbreak.lname }}"  data-purok="{{ outbreak.purok }}" data-severity="{{ outbreak.severity }}">Update</button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>


                    <div class="Total Cases" id="Cases-area" style="display: none;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Outbreak Name</th>
                                    <th>Purok</th>
                                    <th>Total Cases</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for outbreak in outbreaks %} 
                                <tr>
                                    <td>{{ outbreak.outbreak_name }}</td>
                                    <td>{{ outbreak.purok }}</td>
                                    <td>{{ outbreak.total_cases_sum }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                        
                </section>  
            
            </div>
        </div>
    </div>

    <!-- Add Outbreak Modal form structure -->
    <div id="Modal-Category-Overlay">
        <div id="CO-Container">
            <div class="CO-Top">
                <h3>Add Outbreak</h3>
            </div>
            <form method="POST" action="{% url 'addOutbreak' %}">
                {% csrf_token %}
                <div class="CO-Bottom">
                    <div class="input-group">
                        <label for="outbreak_name">Outbreak Name:</label>
                        <input type="text" id="outbreak_name" name="outbreak_name" placeholder="Enter outbreak name" required>
                    </div>
                    <div class="input-group">
                        <label for="fname">First Name:</label>
                        <input type="text" id="fname" name="fname" placeholder="Enter first name" required>
                    </div>
                    <div class="input-group">
                        <label for="lname">Last  Name:</label>
                        <input type="text" id="lname" name="lname" placeholder="Enter last name" required>
                    </div>
                    <div class="input-group">
                        <label for="purok">Purok:</label>
                        <select id="purok" name="purok" required>
                            <option value="1A">1A</option>
                            <option value="1B">1B</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="date">Date:</label>
                        <input type="date" id="date" name="date" required>
                    </div>
                    <div class="input-group">
                        <label for="severity">Severity:</label>
                        <select id="severity" name="severity" required>
                            <option value="mild">Mild</option>
                            <option value="moderate">Moderate</option>
                            <option value="severe">Severe</option>
                        </select>
                    </div>
                </div>
                <div class="CO-Bottom2">
                    <button type="button" id="cancel-category">Cancel</button>
                    <button type="submit" id="add-category">Submit</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Update Outbreak Modal form structure -->
    <div id="Update-Modal-Overlay">
        <div id="CO-Container">
            <div class="CO-Top">
                <h3>Update Outbreak</h3>
            </div>
            <form method="POST" action="{% url 'updateOutbreak' %}">
                {% csrf_token %}
                <input type="hidden" id="update_outbreak_id" name="outbreak_id">
                <div class="CO-Bottom">
                    <div class="input-group">
                        <label for="update_outbreak_name">Outbreak Name:</label>
                        <input type="text" id="update_outbreak_name" name="outbreak_name" placeholder="Enter outbreak name" required>
                    </div>
                    <div class="input-group">
                        <label for="update_fname">First Name:</label>
                        <input type="text" id="update_fname" name="update_fname" placeholder="Enter first name" required>
                    </div>
                    <div class="input-group">
                        <label for="update_lname">Last  Name:</label>
                        <input type="text" id="update_lname" name="update_lname" placeholder="Enter last name" required>
                    </div>
                    
                    <div class="input-group">
                        <label for="purok">Purok:</label>
                        <select id="purok" name="purok" required>
                            <option value="1A">1A</option>
                            <option value="1B">1B</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                        </select>
                        <div class="input-group">
                            <label for="date">Date:</label>
                            <input type="date" id="date" name="date" required>
                        </div>
                    <div class="input-group">
                        <label for="update_severity">Severity:</label>
                        <select id="update_severity" name="severity" required>
                            <option value="mild">Mild</option>
                            <option value="moderate">Moderate</option>
                            <option value="severe">Severe</option>
                        </select>
                    </div>
                </div>
                <div class="CO-Bottom2">
                    <button type="button" id="cancel-update">Cancel</button>
                    <button type="submit" id="update-category">Submit</button>
                </div>
            </form>
        </div>
    </div>

<script>
    // Add Outbreak Modal
    document.getElementById('openModalButton').onclick = function() {
        document.getElementById('Modal-Category-Overlay').style.display = 'flex';
    };
    document.getElementById('cancel-category').onclick = function() {
        document.getElementById('Modal-Category-Overlay').style.display = 'none';
    };

    // Update Modal
    document.querySelectorAll('.update-btn').forEach(button => {
        button.onclick = function() {
   
            document.getElementById('Update-Modal-Overlay').style.display = 'flex';
            document.getElementById('update_outbreak_id').value = this.getAttribute('data-id');
            document.getElementById('update_outbreak_name').value = this.getAttribute('data-outbreak_name');
            document.getElementById('update_fname').value = this.getAttribute('data-fname');
            document.getElementById('update_lname').value = this.getAttribute('data-lname');
            document.getElementById('update_purok').value = this.getAttribute('data-purok');
            document.getElementById('update_date').value = this.getAttribute('data-date');
            document.getElementById('update_severity').value = this.getAttribute('data-severity');
        };
    });

    document.getElementById('cancel-update').onclick = function() {
        document.getElementById('Update-Modal-Overlay').style.display = 'none';
    };


    // Total Cases Modal
    document.getElementById('totalCasesBtn').onclick = function() {
        document.getElementById('Modal-Category-Overlay').style.display = 'flex';
    };
    document.getElementById('cancel-category').onclick = function() {
        document.getElementById('Modal-Category-Overlay').style.display = 'none';
    };
</script>
{% endblock %}
