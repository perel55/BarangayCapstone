{% load static %}
{% block css %}
<link rel="stylesheet" href="{% static 'css/bhw.css' %}">
<link rel="stylesheet" href="{% static 'css/maintenance.css' %}">
{% endblock %}

{% block content %}
{% include 'healthAdmin/healthTopnav.html' %}

<div class="MaintenanceProfile">
    <section id="maintenance-content">
        <div class="profile-card">
            <h2>User Profile</h2>
            <div class="profile-details">
                <p><strong>Username:</strong> {{ schedule.user.username }}</p>
                <p><strong>Full Name:</strong> {{ schedule.user.first_name }} {{ schedule.user.last_name }}</p>
                <p><strong>Purok:</strong> {{ schedule.resident.zone }}</p>
                <p><strong>Date:</strong> {{ schedule.date }}</p>
                <p><strong>Phone Number:</strong> {{ schedule.resident.phone_number }}</p>
            </div>
            <div class="maintenance-button">
                <a href="{% url 'bhwImmunize' %}" class="back-btn">Back</a>
                <button id="addImmunizeButton" class="released-btn">Add Immunization</button>
            </div>
        </div>
    </section>
</div>

<div class="released-record">
    <table>
        <thead>
            <tr>
                <th>Bakuna</th>
                <th>1st Visit (1 1/2months)</th>
                <th>2nd Visit (2 1/2months)</th>
                <th>3rd Visit (3 1/2months)</th>
                <th>4th Visit (9 Months)</th>
                <th>5th Visit (1 Year)</th>
                <th>Action</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for immunization in immunizations %}
            <tr>
                <td>{{ immunization.vaccine_name }}</td>
                <td>{{ immunization.first_visit }}</td>
                <td>{{ immunization.second_visit }}</td>
                <td>{{ immunization.third_visit }}</td>
                <td>{{ immunization.fourth_visit }}</td>
                <td>{{ immunization.fifth_visit }}</td>
                <td>
                    <button class="update-btn" data-immunize-id="{{ immunization.id }}" data-vaccine-name="{{ immunization.vaccine_name }}"
                        data-first-visit="{{ immunization.first_visit }}" data-second-visit="{{ immunization.second_visit }}"
                        data-third-visit="{{ immunization.third_visit }}" data-fourth-visit="{{ immunization.fourth_visit }}"
                        data-fifth-visit="{{ immunization.fifth_visit }}">Update</button>
                </td>
                <td>
                    <select name="status_{{ immunization.id }}">
                        <option value="Pending" {% if immunization.status == 'Pending' %}selected{% endif %}>Pending</option>
                        <option value="Completed" {% if immunization.status == 'Completed' %}selected{% endif %}>Completed</option>
                    </select>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="9">No immunization records found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Add Immunize Modal -->
<div id="addImmunizeModal" class="modal">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2>Add Immunization</h2>
        <form method="POST" action="{% url 'add_immunize' schedule.id %}">
            {% csrf_token %}
            
            <label for="vaccine_name">Vaccine Name:</label>
            <select id="vaccine_name" name="vaccine_name" required>
                <option value="Pentavalent Vaccine">Pentavalent Vaccine</option>
                <option value="Oral Polio Vaccine (OPV)">Oral Polio Vaccine (OPV)</option>
                <option value="Inactivated Polio Vaccine">Inactivated Polio Vaccine</option>
                <option value="Pneumococcal Conjugate Vaccine">Pneumococcal Conjugate Vaccine</option>
                <option value="Measles, Mumps, Rubella">Measles, Mumps, Rubella</option>
            </select>
        
            <!-- 1st Visit -->
            <label for="first_visit">1st Visit:</label>
            {% if first_visit %}
                <!-- Hide the input field if there's already data -->
                <p>Already set</p>
            {% else %}
                <input type="date" id="first_visit" name="first_visit">
            {% endif %}
        
            <!-- 2nd Visit -->
            <label for="second_visit">2nd Visit:</label>
            {% if second_visit %}
                <!-- Hide the input field if there's already data -->
                <p>Already set</p>
            {% else %}
                <input type="date" id="second_visit" name="second_visit">
            {% endif %}
        
            <!-- 3rd Visit -->
            <label for="third_visit">3rd Visit:</label>
            {% if third_visit %}
                <!-- Hide the input field if there's already data -->
                <p>Already set</p>
            {% else %}
                <input type="date" id="third_visit" name="third_visit">
            {% endif %}
        
            <!-- 4th Visit -->
            <label for="fourth_visit">4th Visit:</label>
            {% if fourth_visit %}
                <!-- Hide the input field if there's already data -->
                <p>Already set</p>
            {% else %}
                <input type="date" id="fourth_visit" name="fourth_visit">
            {% endif %}
        
            <!-- 5th Visit -->
            <label for="fifth_visit">5th Visit:</label>
            {% if fifth_visit %}
                <!-- Hide the input field if there's already data -->
                <p>Already set</p>
            {% else %}
                <input type="date" id="fifth_visit" name="fifth_visit">
            {% endif %}
        
            <button type="submit">Add Record</button>
        </form>
    </div>
</div>



{% endblock %}


<script>
  document.addEventListener("DOMContentLoaded", function () {
    const addModal = document.getElementById("addImmunizeModal");
    const updateModal = document.getElementById("updateImmunizeModal");
    const closeButtons = document.querySelectorAll(".close-btn");

    // Open Add Immunize Modal
    document.getElementById("addImmunizeButton").addEventListener("click", function () {
        addModal.style.display = "block";
    });

    // Open Update Immunize Modal
    document.querySelectorAll(".update-btn").forEach(button => {
        button.addEventListener("click", function () {
            const immunizeId = this.getAttribute("data-immunize-id");
            const vaccineName = this.getAttribute("data-vaccine-name");
            const firstVisit = this.getAttribute("data-first-visit");
            const secondVisit = this.getAttribute("data-second-visit");
            const thirdVisit = this.getAttribute("data-third-visit");
            const fourthVisit = this.getAttribute("data-fourth-visit");
            const fifthVisit = this.getAttribute("data-fifth-visit");

            document.getElementById("immunize_id").value = immunizeId || "";
            document.getElementById("update_vaccine_name").value = vaccineName || "";
            document.getElementById("update_first_visit").value = firstVisit || "";
            document.getElementById("update_second_visit").value = secondVisit || "";
            document.getElementById("update_third_visit").value = thirdVisit || "";
            document.getElementById("update_fourth_visit").value = fourthVisit || "";
            document.getElementById("update_fifth_visit").value = fifthVisit || "";

            updateModal.style.display = "block";
        });
    });

    // Close Modals
    closeButtons.forEach(button => {
        button.addEventListener("click", function () {
            addModal.style.display = "none";
            updateModal.style.display = "none";
        });
    });

    // Close Modal on Outside Click
    window.addEventListener("click", function (event) {
        if (event.target === addModal) {
            addModal.style.display = "none";
        }
        if (event.target === updateModal) {
            updateModal.style.display = "none";
        }
    });
});

</script>

